<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>SLIDE News — Feed</title>

<style>
* {box-sizing:border-box; margin:0; padding:0; font-family:"Poppins",sans-serif;}
body {background:#000; color:#fff; height:100vh; display:flex; flex-direction:column; overflow:auto;}

/* HEADER */
header {
  position:fixed; top:0; width:100%; height:80px;
  display:flex; align-items:center; justify-content:space-between;
  padding:0 25px;
  background:linear-gradient(90deg,#ff0080,#ff8c00,#40e0d0);
  border-bottom-left-radius:25px; border-bottom-right-radius:25px;
  z-index:12; box-shadow:0 4px 20px rgba(255,0,128,0.5);
}
header .title {font-size:30px; font-weight:800; letter-spacing:1px; display:flex; align-items:center;}
header .title #user-email {font-size:16px; font-weight:400; color:#fff; opacity:0.8; margin-left:10px;}
.header-heart-btn {
  width:52px; height:40px; border-radius:12px; display:flex; align-items:center; justify-content:center;
  cursor:pointer; border:0; outline:none;
  background: linear-gradient(90deg,#ff2d78,#ff6b3d,#ffcc33);
  box-shadow: 0 8px 30px rgba(255,45,120,0.25), inset 0 -2px 6px rgba(0,0,0,0.25);
  font-size:20px; color:white;
}

/* CATEGORY NAV */
#category-bar-container { position:fixed; top:630px; left:63px; width:75%; display:flex; justify-content:center; z-index:11; }
#category-bar { display:flex; overflow-x:auto; scroll-behavior:smooth; padding:10px 80px; gap:15px; border-radius:100px; }
#category-bar::-webkit-scrollbar { display:flex; }

.category-item {
  flex:0 0 auto; padding:10px 25px; border-radius:50px; background:#111; color:rgba(255,255,255,0.8);
  font-weight:bold; font-size:15px; text-align:center; cursor:pointer;
  transition: transform 0.4s cubic-bezier(0.4,0,0.2,1), opacity 0.4s ease; white-space:nowrap;
}
.category-item.active {
  transform: scale(1.2); opacity:1;
  background: linear-gradient(#FFF32D,#FF2D78); color:#fff;
  box-shadow:0 10px 20px #00bfff,0 10px 40px #2dfeff,10px 0 60px #39ff14,20px 0 80px #ff2bc2;
}

/* CAROUSEL */
.carousel {
  position:relative; flex:1; overflow-y:scroll; scroll-snap-type:y mandatory; scroll-behavior:smooth;
  padding-top:150px; padding-bottom:100px;
}

.news-card {
  scroll-snap-align:center; height:calc(100vh - 250px); display:flex; flex-direction:column; justify-content:flex-start;
  border-radius:25px; margin:30px 20px; color:white; padding:15px; text-align:left;
  transform: scale(0.9); opacity:0.4; transition: transform 0.6s ease, opacity 0.6s ease; cursor:pointer;
  background:#111; border: 1px solid rgba(255,255,255,0.03);
}
.news-card.active { transform: scale(1); opacity:1; }

/* Keep image as-is (not tinted) */
.news-card img { width:100%; border-radius:18px; height:100%; object-fit:cover; margin-bottom:15px; box-shadow:0 8px 20px rgba(0,0,0,0.3); }

/* text/icons remain white/default */
.news-title { font-size:20px; font-weight:700; margin-bottom:10px; color:#fff; }
.news-text { font-size:15px; line-height:1.6; opacity:0.95; margin-bottom:10px; color:#fff; }

/* MODIFIED: Styling for SVG icons in News Card */
.news-icons { display:flex; justify-content:flex-end; gap:15px; }
.news-icons span {
  cursor:pointer;
  transition: transform 0.18s ease;
  user-select:none; display:inline-block; line-height:1;
  width: 24px; 
  height: 24px;
}
.news-icons span:hover { transform: scale(1.1); } /* Add hover effect */

/* --- NEW: Icon styling to match the second snippet --- */
.news-icons span svg .icon {
    fill: none;
    stroke: white; /* BOLD WHITE OUTLINE */
    stroke-width: 2.2; /* BOLDER OUTLINE */
    transition: fill .28s ease, stroke .18s ease, transform .18s ease;
    transform-origin: center;
}

/* ACTIVE LIKE STATE */
.news-icons span.liked svg .icon {
  fill: url(#feedLikeGradient); /* Use the new gradient ID */
  stroke: none;
}
.news-icons span.liked svg { 
    transform: scale(1.06); 
    transition: transform .16s cubic-bezier(.2,.9,.2,1); 
}

/* ACTIVE SAVE STATE */
.news-icons span.saved svg .icon {
  fill: white; /* Solid white for saved */
  stroke: none;
  stroke-width: 0;
}
.news-icons span:not(.saved) svg .icon.bookmark {
    stroke-width: 2.2; 
}


/* FOOTER */
footer {
  height:70px; display:block; justify-content:space-around; align-items:center;
  border-top-left-radius:25px; border-top-right-radius:25px;
  background: rgba(20,20,20,0.85); backdrop-filter:blur(10px); box-shadow:0 -4px 30px rgba(255,255,255,0.3);
  z-index:10;
}
/* MODIFIED: Styling for footer icons */
footer .nav-icon {
  width: 26px;
  height: 26px;
  cursor:pointer;
  transition:all 0.3s ease;
}
footer .nav-icon svg {
  width: 100%;
  height: 100%;
  stroke: white; /* Outlined white */
  fill: none;
  stroke-width: 2.2; /* Bolder outline for professional look */
  transition:all 0.3s ease;
}
footer .nav-icon.active svg { 
  fill: white; /* Solid white for active state */
  stroke: none;
}
footer .nav-icon:hover { transform:scale(1.3); }

/* SHIMMER styles (unchanged) */
.shimmer-card {
  scroll-snap-align:center; height:calc(100vh - 250px); display:flex; flex-direction:column; justify-content:flex-start;
  border-radius:25px; margin:30px 20px; padding:15px; background:#111; transform:scale(0.9); opacity:0.4;
  transition: transform 0.6s ease, opacity 0.6s ease;
}
.shimmer-image, .shimmer-line { position:relative; overflow:hidden; background:#222; border-radius:16px; margin-bottom:15px; }
.shimmer-image { height:50%; border-radius:18px; }
.shimmer-line.full { height:50px; width:90%; }
.shimmer-line.medium { height:50px; width:80%; }
.shimmer-line.short { height:50px; width:60%; }

.shimmer::before {
  content:""; position:absolute; top:0; left:-150px; height:100%; width:150px;
  background:linear-gradient(90deg,transparent,rgba(255,255,255,0.08),transparent); animation:shimmer 1.5s infinite;
}
@keyframes shimmer { 100% { transform: translateX(300%); } }

.no-more { text-align:center; padding:30px 20px; color:rgba(255,255,255,0.6); font-size:14px; }

/* TOAST STYLES (for news.html) */
.toast {
    position:fixed;
    left:50%;
    bottom:80px; 
    transform:translateX(-50%) translateY(12px);
    background:rgba(0,0,0,0.72);
    color:#fff;
    padding:10px 14px;
    border-radius:12px;
    font-weight:600;
    font-size:15px;
    pointer-events:none;
    opacity:0;
    z-index:360;
    transition:transform .22s ease, opacity .22s ease;
    box-shadow:0 12px 30px rgba(0,0,0,0.5);
    display:flex;
    gap:10px;
    align-items:center;
}
.toast.show { opacity:1; transform:translateX(-50%) translateY(0); }

/* FLOATING HEART styles (for news.html) */
.pop-heart-svg{ /* CHANGED CLASS NAME */
    position:fixed;
    left:50%;
    top:50%; /* Center of the screen */
    transform:translate(-50%,-50%) scale(0.2);
    width:84px; /* Smaller size for feed pop */
    height:84px;
    pointer-events:none;
    z-index:350;
    opacity:0;
    text-shadow:
      0 6px 20px rgba(255,45,85,0.32),
      0 2px 6px rgba(0,0,0,0.6);
    animation: none;
    will-change:transform,opacity;
}
@keyframes popHeartAnim {
    0%   { transform:translate(-50%,-50%) scale(0.2); opacity:0; }
    10%  { transform:translate(-50%,-50%) scale(1.6); opacity:1; }
    60%  { transform:translate(-50%,-50%) scale(1.0); opacity:1; }
    100% { transform:translate(-50%,-50%) scale(1.0); opacity:0; }
}

</style>
</head>

<body>
<header>
  <div class="title">SLIDE <span id="user-email"></span></div>
  <button class="header-heart-btn" id="header-heart">❤️</button>
</header>

<div id="category-bar-container">
  <div id="category-bar">
    <div class="category-item active" data-category="For You">For You</div>
    <div class="category-item" data-category="Global">Global</div>
    <div class="category-item" data-category="Business and finance">Business and finance</div>
    <div class="category-item" data-category="Science and technology">Science and technology</div>
    <div class="category-item" data-category="Entertainment">Entertainment</div>
    <div class="category-item" data-category="Sports">Sports</div>
    <div class="category-item" data-category="Lifestyle">Lifestyle</div>
    <div class="category-item" data-category="Trending">Trending</div>
  </div>
</div>

<div class="carousel" id="news-container"></div>

<footer>
  <span class="nav-icon home active" data-target="home">
    <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 10l9-7 9 7v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-10z"/></svg>
  </span>
  <span class="nav-icon search" data-target="search">
    <svg viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
  </span>
  <span class="nav-icon bookmark" data-target="bookmark">
    <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6 2h12a1 1 0 0 1 1 1v18l-7-4-7 4V3a1 1 0 0 1 1-1z"/></svg>
  </span>
</footer>

<svg width="0" height="0" style="position:absolute" aria-hidden="true" focusable="false">
    <defs>
      <linearGradient id="feedLikeGradient" x1="0" x2="1" y1="0" y2="1">
        <stop offset="0%" stop-color="#ff2d55"/>
        <stop offset="30%" stop-color="#ff9a3c"/>
        <stop offset="60%" stop-color="#3aa3ff"/>
        <stop offset="100%" stop-color="#d94cff"/>
      </linearGradient>

      <linearGradient id="feedPopGradient" x1="0" x2="1" y1="0" y2="1">
        <stop offset="0%" stop-color="#ff3b6b"/>
        <stop offset="35%" stop-color="#ffb45a"/>
        <stop offset="65%" stop-color="#4cc2ff"/>
        <stop offset="100%" stop-color="#ff6ad1"/>
      </linearGradient>
    </defs>
</svg>

<div id="toast" class="toast" role="status" aria-live="polite" style="display:none"></div>

<div id="floatingLayer" aria-hidden="true"></div>

<script>
/* ========== INITIAL STATE & CONFIG ========== */
const container = document.getElementById('news-container');
const emailDisplay = document.getElementById('user-email');
const params = new URLSearchParams(window.location.search);
const userEmail = params.get('email') || localStorage.getItem('userEmail') || 'unknown@user.com';
emailDisplay.innerText = userEmail;

const categoryItems = document.querySelectorAll('.category-item');
const categoryBar = document.getElementById('category-bar');

const PAGE_SIZE = 5;
let currentPage = 1;
let selectedCategory = "For You";
let keepFetching = true;
let shownNewsSet = new Set();
let clickedNewsBuffer = [];
let fetchingInProgress = false;

const categoryMap = {
  "For You":"For You",
  "Global":"General / Global",
  "Business and finance":"Business & Finance",
  "Science and technology":"Science & Technology",
  "Entertainment":"Entertainment",
  "Sports":"Sports",
  "Lifestyle":"Lifestyle & Society",
  "Trending":"Trending"
};

/* ===== NEWS CARD COLORS (palette) ===== */
const newsColors = [
  "#B92EFF",
  "#FF2D78",
  "#3A7BFF",
  "#A93AFF",
  "#FF6B3D"
];
let colorIndex = 0;

/* TOAST LOGIC */
const toastEl = document.getElementById('toast');
let toastTimer = null;
function showToast(message) {
  toastEl.style.display = 'flex';
  toastEl.innerHTML = message;
  requestAnimationFrame(()=> toastEl.classList.add('show'));
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=> {
    toastEl.classList.remove('show');
    setTimeout(()=> { toastEl.style.display='none'; }, 260);
  }, 2000);
}

/* FLOATING HEART LOGIC (MODIFIED) */
function showFloatingHeart() {
  const layer = document.getElementById('floatingLayer');
  const wrapper = document.createElement('div');
  wrapper.className = 'pop-heart-svg'; // Use the new class
  
  // Reset animation and trigger
  wrapper.style.animation = 'none'; 
  layer.appendChild(wrapper);

  // Use the SVG from the second snippet with the popGradient ID
  wrapper.innerHTML = `
    <svg viewBox="0 0 24 24" width="84" height="84" aria-hidden="true">
      <path class="icon heart" d="M12.1 21s-7.8-4.5-9.4-8.1C0.6 9.7 3.2 6 7.2 6c2.2 0 3.5 1.3 4.8 2.7L12 9.9l0.1-1.2C13.4 7.3 14.8 6 17 6c4 0 6.6 3.7 4.5 6.9-1.6 3.6-9.4 8.1-9.4 8.1z" fill="url(#feedPopGradient)" />
    </svg>
  `;

  requestAnimationFrame(() => {
    wrapper.style.animation = 'popHeartAnim 2s cubic-bezier(.2,.9,.2,1) forwards';
  });
  
  // Remove after animation completes
  setTimeout(()=> {
    wrapper.remove();
  }, 2050);
}


/* ========== SINGLE OBSERVER FOR CARD ACTIVATION ========== */
const observer = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    entry.target.classList.toggle('active', entry.isIntersecting);
  });
}, { threshold: 0.5 });

/* ========== SHIMMER HELPERS ========== */
function showShimmer(count = 3) {
  const shimmerElems = [];
  for (let i = 0; i < count; i++) {
    const shimmer = document.createElement('div');
    shimmer.className = 'shimmer-card shimmer';
    shimmer.innerHTML = `
      <div class="shimmer-image shimmer"></div>
      <div class="shimmer-line full shimmer"></div>
      <div class="shimmer-line medium shimmer"></div>
      <div class="shimmer-line short shimmer"></div>
    `;
    container.appendChild(shimmer);
    shimmerElems.push(shimmer);
  }
  return shimmerElems;
}

/* ========== CREATE CARD (sequential color) (MODIFIED SVG) ========== */
function createNewsCard(news) {
  const card = document.createElement('div');
  card.className = 'news-card';

  let imgHtml = '';
  if (news.image && news.image.trim()) {
    imgHtml = `<img src="${news.image}" alt="News">`;
  } else {
    imgHtml = `<div style="height:50%; background:#1a1a1a; border-radius:18px; margin-bottom:15px;"></div>`;
  }

  // Sequential color assignment
  const color = newsColors[colorIndex % newsColors.length];
  colorIndex++; // next card will get next color

  // Apply color only to card background (keep text/icons white)
  card.style.background = color;

  const headlineHtml = `<div class="news-title">${escapeHtml(news.headline)}</div>`;
  const textSnippet = escapeHtml(news.description || '').slice(0, 220) + (news.description && news.description.length > 220 ? '...' : '');
  const descriptionHtml = `<div class="news-text">${textSnippet}</div>`;

  // MODIFIED: Replacing Emojis with Outlined SVGs that have the '.icon' class
  const heartSvg = `
    <svg viewBox="0 0 24 24" aria-hidden="true" width="24" height="24">
        <path class="icon heart" d="M12.1 21s-7.8-4.5-9.4-8.1C0.6 9.7 3.2 6 7.2 6c2.2 0 3.5 1.3 4.8 2.7L12 9.9l0.1-1.2C13.4 7.3 14.8 6 17 6c4 0 6.6 3.7 4.5 6.9-1.6 3.6-9.4 8.1-9.4 8.1z"/>
    </svg>`;
  const bookmarkSvg = `
    <svg viewBox="0 0 24 24" aria-hidden="true" width="24" height="24">
        <path class="icon bookmark" d="M6 2h12a1 1 0 0 1 1 1v18l-7-4-7 4V3a1 1 0 0 1 1-1z"/>
    </svg>`;

  card.innerHTML = `
    ${imgHtml}
    ${headlineHtml}
    ${descriptionHtml}
    <div class="news-icons">
      <span class="like" title="Like">${heartSvg}</span>
      <span class="save" title="Save">${bookmarkSvg}</span>
    </div>
  `;

  // Like/Save handlers
  const likeBtn = card.querySelector('.like');
  const saveBtn = card.querySelector('.save');
  likeBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    const nowLiked = likeBtn.classList.toggle('liked');
    if (nowLiked) {
        showFloatingHeart(); // Show floating heart only on LIKE
        sendAction('like', news);
    } else {
        sendAction('unlike', news);
    }
  });
  saveBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    const nowSaved = saveBtn.classList.toggle('saved');
    if (nowSaved) {
        showToast('Saved successfully in bookmark 🔖');
        sendAction('save', news);
    } else {
        showToast('Unsaved successfully in bookmark 🔖');
        sendAction('unsave', news);
    }
  });

  // ----------------------------
  // RELIABLE CLICK: store article to sessionStorage THEN open fullnews.html
  // ----------------------------
  card.addEventListener('click', () => {
    try {
      sessionStorage.setItem('fullnews_data', JSON.stringify(news));
    } catch (e) {
      console.warn('sessionStorage set failed', e);
    }

    // Try to open in new tab; fallback to same tab if blocked
    const newWin = window.open('fullnews.html', '_blank');
    if (!newWin) {
      window.location.href = 'fullnews.html';
    } else {
      newWin.focus();
    }

    // clicked buffer behavior (unchanged)
    clickedNewsBuffer.push(news);
    if (clickedNewsBuffer.length === 3) {
      sendCurrentFeed(clickedNewsBuffer).then(() => clickedNewsBuffer = []).catch(() => clickedNewsBuffer = []);
    }
  });

  // observe for activation
  observer.observe(card);

  return card;
}

/* simple escape for text inserted as HTML */
function escapeHtml(str = '') {
  return String(str)
    .replaceAll('&', '&amp;')
    .replaceAll('<', '&lt;')
    .replaceAll('>', '&gt;')
    .replaceAll('"', '&quot;')
    .replaceAll("'", '&#39;');
}

/* ========== FETCH NEWS WITH PAGINATION (unchanged) ========== */
async function fetchNews(infinite = true) {
  if (fetchingInProgress) return;
  fetchingInProgress = true;

  if (!infinite) {
    // 1. CLEAR CONTENT IMMEDIATELY: This is the fix. 
    // It guarantees the container is visually empty before any new elements (shimmers or news) are added.
    container.innerHTML = ""; 
    
    // 2. Reset State
    shownNewsSet.clear();
    currentPage = 1;
    keepFetching = true;
    colorIndex = 0; // reset color cycle for the new category
  }

  if (!keepFetching) {
    fetchingInProgress = false;
    return;
  }

  const shimmerElems = showShimmer(3); // Shimmers are now added to an empty container

  try {
    const body = { email: userEmail, page: currentPage, pageSize: PAGE_SIZE };
    if (selectedCategory !== "For You") body.Categories = categoryMap[selectedCategory];

    const res = await fetch(`https://n8n-8ush.onrender.com/webhook/feed`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body),
    });

    if (!res.ok) throw new Error('Network response was not ok');

    const json = await res.json();
    const output = json.output || {};

    shimmerElems.forEach(s => s.remove());

    // ... (rest of the news processing logic remains the same) ...
    const items = [];
    for (let i = 1; i <= PAGE_SIZE; i++) {
      const h = output[`headline{${i}}`] || output[`headline${i}`];
      const n = output[`news{${i}}`] || output[`news${i}`];
      if (!h || !n) continue;
      if (String(h).toLowerCase().includes("headline1")) continue;
      items.push({
        headline: h,
        description: n,
        image: output[`image${i}`] || "",
        categories: output[`categories${i}`] || "",
        link: output[`link${i}`] || ""
      });
    }

    if (items.length === 0) {
      keepFetching = false;
      const nm = document.createElement('div');
      nm.className = 'no-more';
      nm.innerText = 'No more news in this category.';
      container.appendChild(nm);
      fetchingInProgress = false;
      return;
    }

    for (const item of items) {
      const key = (item.headline + '||' + item.description).trim();
      if (shownNewsSet.has(key)) continue;
      shownNewsSet.add(key);
      const card = createNewsCard(item);
      container.appendChild(card);
    }

    if (items.length < PAGE_SIZE) {
      keepFetching = false;
      const nm = document.createElement('div');
      nm.className = 'no-more';
      nm.innerText = 'No more news in this category.';
      container.appendChild(nm);
    } else {
      currentPage++;
    }

  } catch (err) {
    console.error('❌ Fetch error:', err);
    shimmerElems.forEach(s => s.remove());
    const errEl = document.createElement('div');
    errEl.className = 'no-more';
    errEl.innerText = 'Could not load news. Check your connection or try again.';
    container.appendChild(errEl);
    keepFetching = false;
  }

  fetchingInProgress = false;
}


/* ========== ACTIONS: like/save + sendCurrentFeed (MODIFIED API URLs) ========== */
async function sendAction(action, news) {
  const urlMap = {
    like: 'https://pulse-1-x2sm.onrender.com/like',
    unlike: 'https://pulse-1-x2sm.onrender.com/unlike',
    save: 'https://pulse-1-x2sm.onrender.com/save',
    unsave: 'https://pulse-1-x2sm.onrender.com/unsave'
  };
  try {
    await fetch(urlMap[action], {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({
        email: userEmail,
        headline: news.headline,
        news: news.description,
        url: news.link,
        image_url: news.image,
        categories: news.categories // Send categories for personalized feed
      })
    });
  } catch (e) {
    console.error('Action failed:', e);
  }
}

async function sendCurrentFeed(buffer) {
  const payload = {};
  buffer.forEach((item, i) => {
    const idx = i + 1;
    payload[`image${idx}`] = item.image || "";
    payload[`headline${idx}`] = item.headline || "";
    payload[`news${idx}`] = item.description || "";
    payload[`link${idx}`] = item.link || "";
  });
  try {
    await fetch('https://n8n-8ush.onrender.com/webhook/currentfeed', {
      method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload)
    });
    console.log('✅ Sent currentfeed', payload);
  } catch (e) {
    console.error('❌ Error sending currentfeed', e);
  }
}

/* ========== UI: footer nav, category clicks, header heart (unchanged) ========== */
document.querySelectorAll('footer .nav-icon').forEach(icon => {
  icon.addEventListener('click', () => {
    document.querySelectorAll('footer .nav-icon').forEach(i => i.classList.remove('active'));
    icon.classList.add('active');
    
    const target = icon.getAttribute('data-target');

    if (target === 'home') {
      keepFetching = true;
      fetchNews(false);
    } else if (target === 'search') {
      keepFetching = false;
      window.location.href = 'search.html';
    } else if (target === 'bookmark') {
      keepFetching = false;
      window.location.href = 'bookmark.html';
    }
  });
});

categoryItems.forEach(item => {
  item.addEventListener('click', () => {
    // 1. IMMEDIATE VISUAL CLEAR: Clears all news cards from the container right now.
    container.innerHTML = ""; 

    // 2. UI & State Reset
    categoryItems.forEach(i => i.classList.remove('active'));
    item.classList.add('active');

    selectedCategory = item.innerText;
    currentPage = 1;
    keepFetching = true;
    shownNewsSet.clear();
    colorIndex = 0;

    // 3. Scroll and Fetch
    const itemRect = item.getBoundingClientRect();
    const barRect = categoryBar.getBoundingClientRect();
    const scrollOffset = itemRect.left - barRect.left - (barRect.width / 2) + (itemRect.width / 2);
    categoryBar.scrollBy({ left: scrollOffset, behavior: 'smooth' });

    // Starts fetching the new category's news
    fetchNews(false); 
  });
});

// header heart animation (unchanged)
document.getElementById('header-heart').addEventListener('click', () => {
  const btn = document.getElementById('header-heart');
  btn.classList.toggle('active');
  btn.animate([{ transform: 'scale(1)' }, { transform: 'scale(1.08)' }, { transform: 'scale(1)' }], { duration: 300, easing: 'ease-out' });
});

/* ========== SCROLL: infinite fetch (unchanged) ========== */
container.addEventListener('scroll', () => {
  if (container.scrollTop + container.clientHeight >= container.scrollHeight - 150) {
    if (keepFetching && !fetchingInProgress) {
      fetchNews(true);
    }
  }
});

/* ========== INITIAL LOAD ========== */
fetchNews(false);
</script>
</body>
</html>
