<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SLIDE — Heart & Neon Modal</title>
<style>
  :root{
    --bg:#06060a;
    --text:#ffffff;
    --muted:rgba(255,255,255,0.75);
    --neon-cyan: rgba(0,200,255,0.95);
  }
  *{box-sizing:border-box;}
  html,body{height:100%;}
  body{
    margin:0;
    min-height:100vh;
    background:linear-gradient(180deg,#000 0%,#06060a 100%);
    color:var(--text);
    font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:24px;
    display:flex;
    justify-content:center;
  }

  main{
    width:100%;
    max-width:980px;
    margin:0 auto;
  }

  .card{
    background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));
    border-radius:14px;
    overflow:visible;
    border:1px solid rgba(255,255,255,0.04);
  }

  .hero-wrap{
    position:relative;
    width:100%;
    border-top-left-radius:14px;
    border-top-right-radius:14px;
    overflow:hidden;
    background:#111;
  }

  .hero{
    display:block;
    width:100%;
    height:48vh;
    object-fit:cover;
    cursor:zoom-in;
    -webkit-user-drag:none;
    background:linear-gradient(180deg,#222,#111);
  }

  /* --- NEW: Icon Container Below Image --- */
  .icon-bar{
    display:flex;
    justify-content:flex-end;
    align-items:center;
    padding:12px 20px 0;
  }
  .action-btn{
    width:40px;
    height:40px;
    border-radius:10px;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    background:transparent; /* transparent by default */
    border:0;
    cursor:pointer;
    transition:transform .12s ease, background .12s ease;
    z-index:30;
    margin-left:8px;
  }
  .action-btn:hover{ background:rgba(255,255,255,0.05); }

  /* Default icon (outline) */
  .action-btn svg .icon {
    fill: none;
    stroke: #ffffff;
    stroke-width: 2;
    transition: fill .28s ease, stroke .18s ease, transform .18s ease;
    transform-origin: center;
    
  }

  /* Like button specific styles (active state) */
  #likeBtn.active svg .icon {
    fill: url(#likeGradient);
    stroke: none;
  }
  #likeBtn.active svg { transform: scale(1.06); transition: transform .16s cubic-bezier(.2,.9,.2,1); }

  /* Save button specific styles (active state) */
  #saveBtn.active svg .icon {
    fill: #fff;
    stroke: #fff;
    stroke-width: 0;
  }
  #saveBtn:not(.active) svg .icon {
    stroke-width: 2; /* Bookmark stroke is thicker for better outline */
  }

  .content{
    padding:20px;
  }
  .headline{
    font-size:22px;
    font-weight:800;
    color:var(--text);
    margin:0 0 14px 0;
    line-height:1.15;
  }
  .news-body{
    margin:0 0 40px 0;
    line-height:1.6rem;
    font-size:16px;
    color:var(--muted);
  }
  /* --- NEW: Source capsule is a div, not a link --- */
  .source-capsule{
    display:inline-flex;
    justify-content:center;
    align-items:center;
    padding:12px 22px;
    border-radius:999px;
    background:linear-gradient(90deg,#FF6B3D,#A0522D);
    color:#fff;
    font-weight:700;
    margin-top:18px;
    font-size:15px;
    cursor:pointer; /* make it feel clickable */
    transition: transform .12s ease;
    box-shadow: 0 0 30px #FF6B3D;
  }
  .source-capsule:hover{ transform:translateY(-2px); }


  /* Modal + Neon glow */
  .img-modal{
    position:fixed;
    inset:0;
    display:none;
    align-items:center;
    justify-content:center;
    z-index:200;
    pointer-events:none;
  }
  .img-modal.open{ display:flex; pointer-events:auto; }

  .img-modal .overlay{
    position:absolute; inset:0;
    background:linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.76));
    backdrop-filter: blur(6px);
  }

  .img-modal .panel{
    position:relative;
    width:100%;
    height:100%;
    border-radius:12px;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:18px;
  }

  /* neon frame container */
  .img-wrap{
    border-radius:12px;
    overflow:hidden;
    padding:6px; /* tiny border-gap so the glow looks framed */
    background:
      radial-gradient(600px 220px at 50% 30%, rgba(0,120,255,0.06), transparent 30%);
    box-shadow:
      0 10px 10px #3A7BFF,
      0 10px 30px #FF6B3D;
    transition: box-shadow .18s ease;
  }

  /* --- CHANGED: The glowing frame itself (Neon blue with opacity 1 box-shadow) --- */
  .neon-frame{
    display:flex;
    border-radius:8px;
    padding:8px;
    background:linear-gradient(180deg, rgba(8,18,30,0.6), rgba(0,0,0,0.45));
    box-shadow:
      0 0 30px rgba(0,200,255,1), /* Changed opacity to 1 */
      0 0 64px rgba(0,200,255,1), /* Reduced second shadow opacity */
      0 20px 60px rgba(0,0,0,0.45);
    animation: neonPulse 2s infinite alternate ease-in-out;
  }

  @keyframes neonPulse{
    from {
      box-shadow:
        0 0 28px rgba(0,200,255,1),
        0 0 50px rgba(0,160,255,0.6),
        0 20px 60px rgba(0,0,0,0.45);
      transform: translateY(0);
    }
    to {
      box-shadow:
        0 0 56px rgba(0,200,255,1),
        0 0 110px rgba(0,160,255,0.8),
        0 28px 70px rgba(0,0,0,0.5);
      transform: translateY(-2px);
    }
  }

  .neon-frame img.fullimg{
    display:block;
    max-width:100%;
    max-height:80vh;
    width:auto;
    height:auto;
    object-fit:contain;
    border-radius:6px;
    background:#000;
  }

  .img-modal .close-btn{
    position:absolute; right:22px; top:22px; width:44px; height:44px;
    border-radius:10px; border:0; background:rgba(0,0,0,0.5); color:#fff;
    display:inline-flex; align-items:center; justify-content:center; cursor:pointer; z-index:30;
  }

  /* floating pop heart (inserted dynamically) */
  .pop-heart-svg{
    position:fixed;
    left:50%;
    top:40%;
    transform:translate(-50%,-50%) scale(.2);
    width:140px;
    height:140px;
    pointer-events:none;
    z-index:350;
    opacity:0;
    filter: drop-shadow(0 10px 32px rgba(0,0,0,0.6));
  }
  @keyframes popHeart {
    0% { transform:translate(-50%,-50%) scale(.2); opacity:0; }
    10% { transform:translate(-50%,-50%) scale(1.6); opacity:1; }
    55% { transform:translate(-50%,-50%) scale(1.0); opacity:1; }
    100% { transform:translate(-50%,-50%) scale(1.0); opacity:0; }
  }

  /* toast (bookmark) */
  .toast {
    position:fixed; left:50%; bottom:8%; transform:translateX(-50%) translateY(12px);
    background:rgba(0,0,0,0.72); color:#fff; padding:10px 14px; border-radius:12px;
    font-weight:600; font-size:15px; pointer-events:none; opacity:0; z-index:360;
    transition: transform .22s ease, opacity .22s ease;
    box-shadow: 0 12px 30px rgba(0,0,0,0.5);
  }
  .toast.show{ opacity:1; transform:translateX(-50%) translateY(0); }

  /* small responsive tweak */
  @media (max-width:720px){
    .hero{ height:36vh; }
    .action-btn{ width:40px; height:40px; }
  }
</style>
</head>
<body>
<main>
  <svg width="0" height="0" style="position:absolute" aria-hidden="true" focusable="false">
    <defs>
      <linearGradient id="likeGradient" x1="0" x2="1" y1="0" y2="1">
        <stop offset="0%" stop-color="#ff2d55"/>
        <stop offset="30%" stop-color="#ff9a3c"/>
        <stop offset="60%" stop-color="#3aa3ff"/>
        <stop offset="100%" stop-color="#d94cff"/>
      </linearGradient>

      <linearGradient id="popGradient" x1="0" x2="1" y1="0" y2="1">
        <stop offset="0%" stop-color="#ff3b6b"/>
        <stop offset="35%" stop-color="#ffb45a"/>
        <stop offset="65%" stop-color="#4cc2ff"/>
        <stop offset="100%" stop-color="#ff6ad1"/>
      </linearGradient>
    </defs>
  </svg>

  <article class="card" id="articleCard" aria-labelledby="headlineText">
    <div class="hero-wrap">
      <button class="img-back" id="imgBack" title="Back" aria-label="Back" style="position:absolute;left:12px;top:12px;z-index:30;background:transparent;border:0;color:#fff;padding:8px;">
        <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true"><path d="M15 18l-6-6 6-6" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>

      <img class="hero" id="heroImage" src="" alt="Article image" />
    </div>

    <div class="icon-bar">
      <button class="action-btn" id="likeBtn" title="Like" aria-pressed="false" aria-label="Like">
        <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true" role="img" focusable="false">
          <path class="icon heart" d="M12.1 21s-7.8-4.5-9.4-8.1C0.6 9.7 3.2 6 7.2 6c2.2 0 3.5 1.3 4.8 2.7L12 9.9l0.1-1.2C13.4 7.3 14.8 6 17 6c4 0 6.6 3.7 4.5 6.9-1.6 3.6-9.4 8.1-9.4 8.1z"/>
        </svg>
      </button>
      <button class="action-btn" id="saveBtn" title="Save" aria-pressed="false" aria-label="Save">
        <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true" role="img" focusable="false">
          <path class="icon bookmark" d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
        </svg>
      </button>
    </div>

    <div style="height:1px;background:rgba(255,255,255,0.03); margin-top:12px;"></div>

    <div class="content">
      <h1 class="headline" id="headlineText">Loading…</h1>
      <div class="news-body" id="newsBody"></div>
      <div id="sourceCapsule" class="source-capsule" role="button" tabindex="0" aria-label="Go to source article on example.com">
        <span id="siteName">example.com</span>
      </div>
    </div>
  </article>
</main>

<div id="floatingLayer" aria-hidden="true"></div>

<div id="toast" class="toast" role="status" aria-live="polite" style="display:none"></div>

<div class="img-modal" id="imgModal" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="overlay" id="modalOverlay" tabindex="-1"></div>
  <div class="panel" role="document">
    <button class="close-btn" id="modalClose" aria-label="Close image">✕</button>
    <div class="img-wrap">
      <div class="neon-frame">
        <img class="fullimg" id="modalImage" src="" alt="Full article image" />
      </div>
    </div>
  </div>
</div>

<script>
/* Utility helpers */
function escapeHtml(s=''){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'",'&#39;'); }
function extractSiteName(url){ try{ const u=new URL(url); const host=u.hostname; const parts=host.split('.'); for(let p of parts) if(p && p.toLowerCase()!=='www') return p; return host; } catch(e){ return 'link'; } }

/* Globals for API calls */
const API_URLS = {
  like: "https://pulse-1-x2sm.onrender.com/like",
  unlike: "https://pulse-1-x2sm.onrender.com/unlike",
  save: "https://pulse-1-x2sm.onrender.com/save",
  unsave: "https://pulse-1-x2sm.onrender.com/unsave"
};
// Placeholder for user data. In a real app, this would come from an authentication system.
const USER_EMAIL = "user@example.com";
let newsData = null; // Will be populated with the current article data

/**
 * Sends a POST request to the specified API endpoint.
 * @param {string} type - 'like', 'unlike', 'save', or 'unsave'.
 * @param {object} data - The news data object.
 */
async function sendActionRequest(type, data) {
  const url = API_URLS[type];
  if (!url || !data) {
    console.error(`Invalid API type (${type}) or missing data.`);
    return;
  }

  const requestBody = {
    email: USER_EMAIL,
    headline: data.headline || '',
    news: data.description || '', // Assuming 'news' key expects the article body/description
    url: data.link || '',
    image_url: data.image || '',
    categories: data.categories || 'general' // Use a fallback category
  };

  try {
    const response = await fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(requestBody),
    });

    if (!response.ok) {
      // Log error but don't stop the UI change
      console.error(`HTTP error! Status: ${response.status} for ${type}`);
    } else {
      console.log(`${type} request successful.`, await response.json());
    }
  } catch (error) {
    console.error(`Error sending ${type} request:`, error);
  }
}


/* Render article */
function renderNews(news){
  newsData = news; // Store the current news data globally
  const hero = document.getElementById('heroImage');
  hero.src = news.image || '';
  hero.alt = news.headline || 'Article image';
  hero.setAttribute('loading','lazy');

  document.getElementById('headlineText').innerText = news.headline || 'Untitled';
  const bodyEl = document.getElementById('newsBody');
  bodyEl.innerHTML = '';

  const raw = news.description || '';
  let paras = [];
  if (raw.includes('\n\n')) {
    paras = raw.split(/\n\s*\n/).map(p=>p.trim()).filter(Boolean);
  } else {
    const sentences = raw.split(/(?<=[.?!])\s+/).filter(Boolean);
    let cur = [];
    for (let i=0;i<sentences.length;i++){
      cur.push(sentences[i]);
      if (cur.length>=3){ paras.push(cur.join(' ')); cur=[]; }
    }
    if (cur.length) paras.push(cur.join(' '));
  }
  paras.forEach(p=>{
    const el = document.createElement('p');
    el.innerHTML = escapeHtml(p);
    bodyEl.appendChild(el);
  });

  const site = extractSiteName(news.link || '');
  document.getElementById('siteName').innerText = site;
  // CHANGED: Source capsule logic to open the link on click
  const capsule = document.getElementById('sourceCapsule');
  capsule.setAttribute('aria-label', `Go to source article on ${site}`);
  capsule.addEventListener('click', () => {
    if (news.link) window.open(news.link, '_blank', 'noopener noreferrer');
  });
  capsule.addEventListener('keydown', (e) => {
    if ((e.key === 'Enter' || e.key === ' ') && news.link) {
      e.preventDefault();
      window.open(news.link, '_blank', 'noopener noreferrer');
    }
  });
}

/* Floating pop heart: creates an SVG element with popGradient fill and animates then removes */
function showFloatingPopHeart(){
  const layer = document.getElementById('floatingLayer');
  const wrapper = document.createElement('div');
  wrapper.className = 'pop-heart-svg';
  wrapper.style.animation = 'popHeart 2000ms cubic-bezier(.2,.9,.2,1) forwards';
  // use an inline svg that references the global popGradient id
  wrapper.innerHTML = `
    <svg viewBox="0 0 24 24" width="140" height="140" aria-hidden="true">
      <path d="M12.1 21s-7.8-4.5-9.4-8.1C0.6 9.7 3.2 6 7.2 6c2.2 0 3.5 1.3 4.8 2.7L12 9.9l0.1-1.2C13.4 7.3 14.8 6 17 6c4 0 6.6 3.7 4.5 6.9-1.6 3.6-9.4 8.1-9.4 8.1z" fill="url(#popGradient)" />
    </svg>
  `;
  layer.appendChild(wrapper);
  // remove after animation
  setTimeout(()=> wrapper.remove(), 2100);
}

/* Toast for save */
const toastEl = document.getElementById('toast');
let toastTimer = null;
function showToast(message){
  toastEl.style.display = 'block';
  toastEl.textContent = message;
  requestAnimationFrame(()=> toastEl.classList.add('show'));
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=> {
    toastEl.classList.remove('show');
    setTimeout(()=> { toastEl.style.display='none'; }, 260);
  }, 1800);
}

/* Modal logic (no changes here) */
const imgModal = document.getElementById('imgModal');
const modalImage = document.getElementById('modalImage');
function openImageModal(src, alt=''){
  if(!src) return;
  modalImage.src = src;
  modalImage.alt = alt;
  imgModal.classList.add('open');
  imgModal.setAttribute('aria-hidden','false');
  document.body.style.overflow = 'hidden';
}
function closeImageModal(){
  imgModal.classList.remove('open');
  imgModal.setAttribute('aria-hidden','true');
  modalImage.src = '';
  document.body.style.overflow = '';
}
document.getElementById('modalClose').addEventListener('click', closeImageModal);
document.getElementById('modalOverlay').addEventListener('click', closeImageModal);
document.addEventListener('keydown', function(e){ if (e.key === 'Escape' && imgModal.classList.contains('open')) closeImageModal(); });

/* Prevent modal when actively scrolling (no changes here) */
let scrollTimer = null;
function markScroll(){ window.__recentScroll = true; clearTimeout(scrollTimer); scrollTimer = setTimeout(()=> { window.__recentScroll = false; }, 120); }
window.addEventListener('wheel', markScroll, {passive:true}); window.addEventListener('touchstart', markScroll, {passive:true}); window.addEventListener('touchmove', markScroll, {passive:true}); window.addEventListener('scroll', markScroll, {passive:true});

/* hero click opens modal (if image src exists) (no changes here) */
document.getElementById('heroImage').addEventListener('click', function(e){
  // Removed the scroll check. Modal will open on every click.
  const src = this.currentSrc || this.src || '';
  if (!src) return; 
  openImageModal(src, this.alt || 'Article image');
});


/* back */
document.getElementById('imgBack').addEventListener('click', ()=> {
  try { window.location.href = 'news.html'; } catch(e) { history.back(); }
});

/* --- NEW: Like button behavior with API call --- */
const likeBtn = document.getElementById('likeBtn');
likeBtn.addEventListener('click', function(e){
  e.stopPropagation();
  const wasActive = this.classList.contains('active');
  const nowActive = this.classList.toggle('active');
  this.setAttribute('aria-pressed', nowActive ? 'true' : 'false');

  if (nowActive) {
    // popped into active state: show pop heart and send 'like'
    showFloatingPopHeart();
    sendActionRequest('like', newsData);
  } else {
    // popped into inactive state: send 'unlike'
    sendActionRequest('unlike', newsData);
  }
});

/* --- NEW: Save button behavior with API call and toast --- */
const saveBtn = document.getElementById('saveBtn');
saveBtn.addEventListener('click', function(e){
  e.stopPropagation();
  const nowActive = this.classList.toggle('active');
  this.setAttribute('aria-pressed', nowActive ? 'true' : 'false');

  if (nowActive) {
    showToast('Saved successfully in bookmark 🔖');
    sendActionRequest('save', newsData);
  } else {
    showToast('Unsaved successfully in bookmark 🔖');
    sendActionRequest('unsave', newsData);
  }
});

/* fallback data + render */
const fallback = {
  image: "https://static.toiimg.com/thumb/msid-124411047,width-1070,height-580,imgsize-831703,resizemode-75,overlay-toi_sw,pt-32,y_pad-40/photo.jpg",
  headline: "Neuroscientist Unveils Simple Techniques to Enhance Workplace Focus and Calm",
  description: `In an increasingly demanding professional landscape, many individuals grapple with burnout and a lack of focus. NYU neuroscientist Dr. Wendy Suzuki offers two straightforward, science-backed methods to cultivate greater concentration, motivation, and tranquility at work.\n\nHer approach centers on simple micro-habits: brief aerobic movement, breathwork, and short mindful pauses throughout the day that reshape neural circuits and reduce stress.\n\nAdopting these small practices consistently can improve attention, mood, and long-term resilience.`,
  link: "https://timesofindia.indiatimes.com/",
  categories: "Science, Health" // Added a categories field for the API
};
let initialNewsData = null;
try { initialNewsData = JSON.parse(sessionStorage.getItem('fullnews_data') || sessionStorage.getItem('newsData') || 'null'); } catch(e){ initialNewsData = null; }
if (!initialNewsData) initialNewsData = fallback;
renderNews(initialNewsData);

</script>
</body>
</html>
